---
title: "Olympic games medals prediction"
author: "Daniel Gribel and Joao Paulo Forny"
date: \today
output:
  beamer_presentation:
    colortheme: default
    fonttheme: default
    theme: default
subtitle: Predicting host country performance
---

## Model

- Medals history
    - \textcolor{red}{80's problem: USSR, East/West Germany}
- Hosting factor
- \textcolor{blue}{Performance analysis on recent competitions}
- Number of athletes participating
- Population (total and growth rate)
    - "Population pyramids" evolution
- GDP (total, per capita and growth rate) and economic freedom
- \textcolor{red}{Sports investment}

## Possible achievements

- Predict medals table for the host country
    + How many medals will Brazil win in Rio'2016?
    + What about medals distribution (gold, silver, bronze)?
    + Is it possible to extend such analysis in order to discriminate predictions for specific sports?
- Investigate hosting factor
    + How does hosting factor effectively contributes for performance improvement?
- Explore visualization mechanisms that may bring some insights

## Validation

- Compare prediction results with past olympic games (2012, 2008, 2004, ...), by shifting datasets in time

## Datasets

### Medals history

- Data Market
    - https://datamarket.com/data/set/24b1/medals-won-at-the-summer-olympic-games

- The Guardian Sport Datablog (~30K medals entries)
    - http://www.theguardian.com/sport/datablog/2012/jun/25/olympic-medal-winner-list-data

- Sports Reference
    - http://www.sports-reference.com/olympics/

### Country indicators

- The World Bank
    - http://data.worldbank.org

## Total of medals (1992 -- 2012)
```{r echo=FALSE}
source("~/PUC-MSc/datascience/olympics/src/script.R")
```
```{r eval=FALSE}
# total of medals for last 6 games 
total_medals <- cbind(total_medals,
    tail(medals[[key_gold]], 6) + 
    tail(medals[[key_silver]], 6) + 
    tail(medals[[key_bronze]], 6))
```
```{r echo=FALSE}
rownames(total_medals) <- paste(years, hosts_acronym)
colnames(total_medals) <- hosts_acronym
total_medals
```

## Total of medals (1992 -- 2012)
```{r, echo=FALSE}
bp_totals <- barplot(total_medals, main="Total of medals (1992, 1996, 2000, 2004, 2008, 2012)",
              ylab = "# Medals",
              beside = TRUE,
              col = total_colors,
              border = NA,
              space = c(0.1,0.8),
              ylim = y_lim_total,
              las = 1)

legend("topleft", legend = c("Performance being host", "Performance being visitor"),
       fill = c("#388BFF", "#ADCFFF"),
       bty = "n",
       inset = 0.03)

text(x = bp_totals, y = array(total_medals), label = array(total_medals), pos = 3,
     cex = 0.8, col = "#444444")
```

## Hosting factor
### Mean away score
```{r eval=FALSE}
# mean away score for last 6 games 
mean_away_factor <- cbind(mean_away_factor,
  mean(
    3*tail(medals[[key_gold]], 6)[-host_pos_tail] +
    2*tail(medals[[key_silver]], 6)[-host_pos_tail] +
    tail(medals[[key_bronze]], 6)[-host_pos_tail]
  ))
```
```{r echo=FALSE}
colnames(mean_away_factor) <- hosts_acronym
mean_away_factor
```

## Hosting factor
### Home score
```{r eval=FALSE}
# home score for last 6 games 
home_factor <- cbind(home_factor,
    3*medals[[key_gold]][host_pos] +
    2*medals[[key_silver]][host_pos] +
    medals[[key_bronze]][host_pos])
```
```{r echo=FALSE}
#colnames(home_factor) <- hosts_acronym
home_factor
```

## Hosting factor
```{r, echo=FALSE}
colors <- c("#DD4200", "#FF9155")

bp_scores <- barplot(rbind(home_factor, mean_away_factor),
              main="Scores (Home x Away)",
              ylab = "Score",
              beside = TRUE,
              col = colors,
              border = NA,
              space = c(0.1,1),
              ylim = y_lim_score,
              las = 1)

legend("topleft", legend = c("Home score", "Away score (mean)"), fill = colors, bty = "n",
       inset = 0.03)

text(x = bp_scores, y = array(rbind(home_factor, mean_away_factor)), label = array(rbind(home_factor, mean_away_factor)), pos = 3, cex = 0.8, col = "#444444")
```

## Hosting factor
```{r eval=FALSE}
home_factor/mean_away_factor
```
```{r echo=FALSE}
round(home_factor/mean_away_factor, 4)
```
```{r}
mean(home_factor/mean_away_factor)
```

## Brazil's performance
```{r, echo=FALSE}
medals_bra <- read.table("../dataset/bra-medals.csv", header = T, sep="\t")

color_medals <- c("#E0D910", "#C8C8C8", "#C7872E")

medals_header <- c("gold", "silver", "bronze")

ylim <- c(0, 1.1*max(medals_bra$gold + medals_bra$silver + medals_bra$bronze))

bp2 <- barplot(t(as.matrix(medals_bra[, medals_header])), main = "Brazil medals distribution (1920 - 2012)", ylab = "# Medals", beside = FALSE, col = color_medals, border = NA, space = 0.2, names.arg = medals_bra$year, las = 2, ylim = ylim)

legend("topleft", legend = medals_header, fill = color_medals, bty = "n", inset = 0.03)

text(x = bp2, y = medals_bra$gold + medals_bra$silver + medals_bra$bronze, label = medals_bra$gold + medals_bra$silver + medals_bra$bronze, pos = 3, cex = 0.8, col = "#666666")

```

## Our first prediction for Brazil medals distribution...
```{r, eval=FALSE}
bra_score <- 
  3*tail(medals$Brazil..Gold, 6) +
  2*tail(medals$Brazil..Silver, 6) +
  tail(medals$Brazil..Bronze, 6)

# ratio: mean between home factor and mean away factor
r <- mean(home_factor/mean_away_factor)

# predicting BRA score
pred_bra_score <- mean(bra_score) * r

# predicting BRA medals distribution
p <- pred_bra_score/3 + pred_bra_score/6 + pred_bra_score/9
pred_bra_gold <- round(bra_gold_perc*p)
pred_bra_silver <- round(bra_silver_perc*p)
pred_bra_bronze <- round(bra_bronze_perc*p)
```

## Our first prediction for Brazil medals distribution...
```{r, echo=FALSE}
ylim_pred <- c(0, 1.2*max(pred_bra))
bp_pred <- barplot(array(pred_bra), col = color_medals, border = NA, ylim = ylim_pred, axes=FALSE)
legend("topleft", legend = medals_header, fill = color_medals, bty = "n", inset = 0.03)
text(x = bp_pred, y = array(pred_bra), label = array(pred_bra), pos = 3, cex = 3.5, col = "#999999")
```

## GDP
- Analyze correlation between GDP growth and medal growth.
    - % of GDP growth should be relative: mean of GDP growth for last 4 years / mean of global GDP growth
    - % of medal growth: (medal count / medal count 4 years ago) - 1
- Fit in a regression model if correlation is observed.

## Correlation: Medals score x GDP
**Correlation coefficient** of two variables: their covariance divided by the product of their individual standard deviations. It is a normalized measurement of how the two are linearly related.

1: variables are positively linearly related

-1: variables are negatively linearly related

```{r echo=FALSE}
cor_gdp_hosts <- round(subset(cor_gdp, select = hosts), 4)
cor_gdp_bra <- round(cor(country_medals_ratio("Brazil"), ind_factor["Brazil",]), 4)
colnames(cor_gdp_hosts) <- hosts_acronym
colnames(cor_gdp_bra) <- "BRA"
```
```{r}
cor_gdp_hosts
```
```{r}
cor_gdp_bra
```